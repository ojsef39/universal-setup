- name: Setup iTerm2
  tags: iTerm2
  vars:
    zsh_custom: "{{ lookup('env', 'ZSH_CUSTOM') }}"
  block:
    - name: (iTerm2) Get current working directory
      ansible.builtin.command: pwd
      register: pwd

    - name: (iTerm2) Synchronize font files
      ansible.posix.synchronize:
        src: "{{ '/tmp/oj39/universal-setup/files/common/fonts/' if pwd.stdout is match('^/tmp/.*') else 'files/common/fonts/' }}"
        dest: "~/Library/Fonts/"

    - name: (iTerm2) Synchronize iTerm2 configuration
      ansible.posix.synchronize:
        src: "/tmp/oj39/universal-setup/files/darwin/iterm2/com.googlecode.iterm2.plist"
        dest: "~/Library/Preferences/com.googlecode.iterm2.plist"
      when: pwd.stdout is match("^/tmp/.*")

    - name: (iTerm2) Link iTerm2 configuration
      ansible.builtin.file:
        src: "{{ playbook_dir }}/files/darwin/iterm2/com.googlecode.iterm2.plist"
        dest: "~/Library/Preferences/com.googlecode.iterm2.plist"
        state: link
        force: true
        follow: false
      when: pwd.stdout is not match("^/tmp/.*")
